!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("buffer"),require("stream"),require("util"),require("crypto")):"function"==typeof define&&define.amd?define(["buffer","stream","util","crypto"],r):(e=e||self).common_tool_utils=r(e.buffer,e.stream,e.util,e.crypto)}(this,function(o,e,s,a){"use strict";function _(e,r){return e(r={exports:{}},r.exports),r.exports}o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;var r=_(function(e,r){var n=o.Buffer;function t(e,r){for(var t in e)r[t]=e[t]}function i(e,r,t){return n(e,r,t)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=o:(t(o,r),r.Buffer=i),i.prototype=Object.create(n.prototype),t(n,i),i.from=function(e,r,t){if("number"==typeof e)throw new TypeError("Argument must not be a number");return n(e,r,t)},i.alloc=function(e,r,t){if("number"!=typeof e)throw new TypeError("Argument must be a number");e=n(e);return void 0!==r?"string"==typeof t?e.fill(r,t):e.fill(r):e.fill(0),e},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o.SlowBuffer(e)}}),t=(r.Buffer,r.Buffer);function n(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=t.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=t.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick(function(){this.emit("end",e),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof e+")")}s.inherits(n,e),n.prototype.write=function(e){this.buffer=t.concat([this.buffer,t.from(e)]),this.emit("data",e)},n.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};var i=n,u=o.Buffer,c=o.SlowBuffer,M=f;function f(e,r){if(!u.isBuffer(e)||!u.isBuffer(r))return!1;if(e.length!==r.length)return!1;for(var t=0,n=0;n<e.length;n++)t|=e[n]^r[n];return 0===t}f.install=function(){u.prototype.equal=c.prototype.equal=function(e){return f(this,e)}};var C=u.prototype.equal,q=c.prototype.equal;f.restore=function(){u.prototype.equal=C,c.prototype.equal=q};var H={ES256:32,ES384:48,ES512:66};var D=function(e){var r=H[e];if(r)return r;throw new Error('Unknown algorithm "'+e+'"')},p=r.Buffer,h=128;function K(e){if(p.isBuffer(e))return e;if("string"==typeof e)return p.from(e,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function J(e,r,t){for(var n=0;r+n<t&&0===e[r+n];)++n;return e[r+n]>=h&&--n,n}var L={derToJose:function(e,r){e=K(e);var t=(r=D(r))+1,n=e.length,i=0;if(48!==e[i++])throw new Error('Could not find expected "seq"');var o=e[i++];if(o===(1|h)&&(o=e[i++]),n-i<o)throw new Error('"seq" specified length of "'+o+'", only "'+(n-i)+'" remaining');if(2!==e[i++])throw new Error('Could not find expected "int" for "r"');if(o=e[i++],n-i-2<o)throw new Error('"r" specified length of "'+o+'", only "'+(n-i-2)+'" available');if(t<o)throw new Error('"r" specified length of "'+o+'", max of "'+t+'" is acceptable');var s=i;if(i+=o,2!==e[i++])throw new Error('Could not find expected "int" for "s"');var a=e[i++];if(n-i!==a)throw new Error('"s" specified length of "'+a+'", expected "'+(n-i)+'"');if(t<a)throw new Error('"s" specified length of "'+a+'", max of "'+t+'" is acceptable');if(t=i,(i+=a)!==n)throw new Error('Expected to consume entire buffer, but "'+(n-i)+'" bytes remain');for(var u=r-o,c=r-a,f=p.allocUnsafe(u+o+c+a),i=0;i<u;++i)f[i]=0;e.copy(f,i,s+Math.max(-u,0),s+o);for(var l=i=r;i<l+c;++i)f[i]=0;return e.copy(f,i,t+Math.max(-c,0),t+a),f=(f=f.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},joseToDer:function(e,r){e=K(e);var t=D(r);if((n=e.length)!==2*t)throw new TypeError('"'+r+'" signatures must be "'+2*t+'" bytes, saw "'+n+'"');var r=J(e,0,t),n=J(e,t,e.length),i=t-r,o=t-n,s=2+i+1+1+o,a=s<h,u=p.allocUnsafe((a?2:3)+s),c=0;return u[c++]=48,a?u[c++]=s:(u[c++]=1|h,u[c++]=255&s),u[c++]=2,u[c++]=i,r<0?(u[c++]=0,c+=e.copy(u,c,0,t)):c+=e.copy(u,c,r,t),u[c++]=2,u[c++]=o,n<0?(u[c++]=0,e.copy(u,c,t)):e.copy(u,c,t+n),u}},l=r.Buffer,G='"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',m="secret must be a string or buffer",d="key must be a string or a buffer",y="function"==typeof a.createPublicKey;function U(e){if(!l.isBuffer(e)&&"string"!=typeof e){if(!y)throw v(d);if("object"!=typeof e)throw v(d);if("string"!=typeof e.type)throw v(d);if("string"!=typeof e.asymmetricKeyType)throw v(d);if("function"!=typeof e.export)throw v(d)}}function F(e){if(!l.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw v("key must be a string, a buffer or an object")}function g(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function z(e){var r=4-(e=e.toString()).length%4;if(4!=r)for(var t=0;t<r;++t)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function v(e){var r=[].slice.call(arguments,1),e=s.format.bind(s,e).apply(null,r);return new TypeError(e)}function b(e){var r;return r=e,e=l.isBuffer(r)||"string"==typeof r?e:JSON.stringify(e)}function Z(n){return function(e,r){var t=r;if(!l.isBuffer(t)&&"string"!=typeof t){if(!y)throw v(m);if("object"!=typeof t)throw v(m);if("secret"!==t.type)throw v(m);if("function"!=typeof t.export)throw v(m)}e=b(e);t=a.createHmac("sha"+n,r);return t.update(e),g(t.digest("base64"))}}function W(n){return function(e,r,t){e=Z(n)(e,t);return M(l.from(r),l.from(e))}}function X(n){return function(e,r){F(r),e=b(e);var t=a.createSign("RSA-SHA"+n);return t.update(e),g(t.sign(r,"base64"))}}function Y(i){return function(e,r,t){U(t),e=b(e),r=z(r);var n=a.createVerify("RSA-SHA"+i);return n.update(e),n.verify(t,r,"base64")}}function Q(n){return function(e,r){F(r),e=b(e);var t=a.createSign("RSA-SHA"+n);return t.update(e),g(t.sign({key:r,padding:a.constants.RSA_PKCS1_PSS_PADDING,saltLength:a.constants.RSA_PSS_SALTLEN_DIGEST},"base64"))}}function ee(i){return function(e,r,t){U(t),e=b(e),r=z(r);var n=a.createVerify("RSA-SHA"+i);return n.update(e),n.verify({key:t,padding:a.constants.RSA_PKCS1_PSS_PADDING,saltLength:a.constants.RSA_PSS_SALTLEN_DIGEST},r,"base64")}}function re(r){var t=X(r);return function(){var e=t.apply(null,arguments);return L.derToJose(e,"ES"+r)}}function te(n){var i=Y(n);return function(e,r,t){return r=L.joseToDer(r,"ES"+n).toString("base64"),i(e,r,t)}}function ne(){return function(){return""}}function ie(){return function(e,r){return""===r}}y&&(d+=" or a KeyObject",m+="or a KeyObject");function oe(e){var r={hs:Z,rs:X,ps:Q,es:re,none:ne},t={hs:W,rs:Y,ps:ee,es:te,none:ie},n=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/i);if(n)return e=(n[1]||n[3]).toLowerCase(),n=n[2],{sign:r[e](n),verify:t[e](n)};throw v(G,e)}var se=o.Buffer,w=function(e){return"string"==typeof e?e:"number"==typeof e||se.isBuffer(e)?e.toString():JSON.stringify(e)},ae=r.Buffer;function ue(e,r){return ae.from(e,r).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ce(e){var r=e.header,t=e.payload,n=e.secret||e.privateKey,e=e.encoding,i=oe(r.alg),e=(t=t,e=(e=e)||"utf8",r=ue(w(r=r),"binary"),t=ue(w(t),e),s.format("%s.%s",r,t)),r=i.sign(e,n);return s.format("%s.%s",e,r)}function S(e){var r=e.secret||e.privateKey||e.key,r=new i(r);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=r,this.payload=new i(e.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}s.inherits(S,e),S.prototype.sign=function(){try{var e=ce({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},S.sign=ce;var fe=S,le=r.Buffer,pe=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function he(e){if("[object Object]"===Object.prototype.toString.call(e))return e;try{return JSON.parse(e)}catch(e){return}}function me(e){e=e.split(".",1)[0];return he(le.from(e,"base64").toString("binary"))}function de(e){return e.split(".")[2]}function ye(e){return pe.test(e)&&!!me(e)}function ge(e,r,t){if(!r)throw(n=new Error("Missing algorithm parameter for jws.verify")).code="MISSING_ALGORITHM",n;var n=de(e=w(e)),e=e.split(".",2).join(".");return oe(r).verify(e,n,t)}function ve(e,r){if(r=r||{},!ye(e=w(e)))return null;var t=me(e);if(!t)return null;n=n||"utf8",i=(i=e).split(".")[1];var n,i=le.from(i,"base64").toString(n);return{header:t,payload:i="JWT"!==t.typ&&!r.json?i:JSON.parse(i,r.encoding),signature:de(e)}}function j(e){var r=(e=e||{}).secret||e.publicKey||e.key,r=new i(r);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=r,this.signature=new i(e.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}s.inherits(j,e),j.prototype.verify=function(){try{var e=ge(this.signature.buffer,this.algorithm,this.key.buffer),r=ve(this.signature.buffer,this.encoding);return this.emit("done",e,r),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},j.decode=ve,j.isValid=ye,j.verify=ge;function be(e,r){if(!(e=x.decode(e,r=r||{})))return null;var t=e.payload;if("string"==typeof t)try{var n=JSON.parse(t);null!==n&&"object"==typeof n&&(t=n)}catch(e){}return!0===r.complete?{header:e.header,payload:t,signature:e.signature}:t}function we(e,r){Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="JsonWebTokenError",this.message=e,r&&(this.inner=r)}function Se(e,r){O.call(this,e),this.name="NotBeforeError",this.date=r}function je(e,r){O.call(this,e),this.name="TokenExpiredError",this.expiredAt=r}var E=j,x={ALGORITHMS:["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],sign:fe.sign,verify:E.verify,decode:E.decode,isValid:E.isValid,createSign:function(e){return new fe(e)},createVerify:function(e){return new E(e)}},O=(we.prototype=Object.create(Error.prototype)).constructor=we,Ee=(Se.prototype=Object.create(O.prototype)).constructor=Se,xe=(je.prototype=Object.create(O.prototype)).constructor=je,T=36e5,k=864e5,Oe=function(e,r){r=r||{};var t=typeof e;if(!("string"==t&&0<e.length)){if("number"==t&&isFinite(e))return(r.long?function(e){var r=Math.abs(e);if(k<=r)return A(e,r,k,"day");if(T<=r)return A(e,r,T,"hour");if(6e4<=r)return A(e,r,6e4,"minute");if(1e3<=r)return A(e,r,1e3,"second");return e+" ms"}:function(e){var r=Math.abs(e);if(k<=r)return Math.round(e/k)+"d";if(T<=r)return Math.round(e/T)+"h";if(6e4<=r)return Math.round(e/6e4)+"m";if(1e3<=r)return Math.round(e/1e3)+"s";return e+"ms"})(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}t=e;if(!(100<(t=String(t)).length)){t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return n*k;case"hours":case"hour":case"hrs":case"hr":case"h":return n*T;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*n;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}};function A(e,r,t,n){r=1.5*t<=r;return Math.round(e/t)+" "+n+(r?"s":"")}function P(e,r){if(r=r||Math.floor(Date.now()/1e3),"string"==typeof e){var t=Oe(e);if(void 0!==t)return Math.floor(r+t/1e3)}else if("number"==typeof e)return r+e}var r=_(function(e,n){n=e.exports=w,c="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},n.SEMVER_SPEC_VERSION="2.0.0";var c,t=256,i=Number.MAX_SAFE_INTEGER||9007199254740991,s=n.re=[],r=n.src=[],e=0,o=(e++,r[0]="0|[1-9]\\d*",e++,r[1]="[0-9]+",e++,r[2]="\\d*[a-zA-Z-][a-zA-Z0-9-]*",e++,r[3]="("+r[0]+")\\.("+r[0]+")\\.("+r[0]+")",e++,r[4]="("+r[1]+")\\.("+r[1]+")\\.("+r[1]+")",e++,r[5]="(?:"+r[0]+"|"+r[2]+")",e++,r[6]="(?:"+r[1]+"|"+r[2]+")",e++,r[7]="(?:-("+r[5]+"(?:\\."+r[5]+")*))",e++,r[8]="(?:-?("+r[6]+"(?:\\."+r[6]+")*))",e++,r[9]="[0-9A-Za-z-]+",e++,r[10]="(?:\\+("+r[9]+"(?:\\."+r[9]+")*))",e++),a="v?"+r[3]+r[7]+"?"+r[10]+"?",u=(r[o]="^"+a+"$","[v=\\s]*"+r[4]+r[8]+"?"+r[10]+"?"),f=e++,l=(r[f]="^"+u+"$",e++,r[13]="((?:<|>)?=?)",e++,r[14]=r[1]+"|x|X|\\*",e++,r[15]=r[0]+"|x|X|\\*",e++,r[16]="[v=\\s]*("+r[15]+")(?:\\.("+r[15]+")(?:\\.("+r[15]+")(?:"+r[7]+")?"+r[10]+"?)?)?",e++,r[17]="[v=\\s]*("+r[14]+")(?:\\.("+r[14]+")(?:\\.("+r[14]+")(?:"+r[8]+")?"+r[10]+"?)?)?",e++),p=(r[l]="^"+r[13]+"\\s*"+r[16]+"$",e++),h=(r[p]="^"+r[13]+"\\s*"+r[17]+"$",e++,r[20]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])",e++,r[21]="(?:~>?)",e++,r[22]="(\\s*)"+r[21]+"\\s+",s[22]=new RegExp(r[22],"g"),e++),m=(r[h]="^"+r[21]+r[16]+"$",e++),d=(r[m]="^"+r[21]+r[17]+"$",e++,r[25]="(?:\\^)",e++,r[26]="(\\s*)"+r[25]+"\\s+",s[26]=new RegExp(r[26],"g"),e++),y=(r[d]="^"+r[25]+r[16]+"$",e++),g=(r[y]="^"+r[25]+r[17]+"$",e++,r[29]="^"+r[13]+"\\s*("+u+")$|^$",e++,r[30]="^"+r[13]+"\\s*("+a+")$|^$",e++,r[31]="(\\s*)"+r[13]+"\\s*("+u+"|"+r[16]+")",s[31]=new RegExp(r[31],"g"),e++,r[32]="^\\s*("+r[16]+")\\s+-\\s+("+r[16]+")\\s*$",e++,r[33]="^\\s*("+r[17]+")\\s+-\\s+("+r[17]+")\\s*$",+e);r[g]="(<|>)?=?\\s*\\*";for(var v=0;v<35;v++)c(v,r[v]),s[v]||(s[v]=new RegExp(r[v]));function b(e,r){if(e instanceof w)return e;if("string"!=typeof e)return null;if(e.length>t)return null;if(!((r=r&&"object"==typeof r?r:{loose:!!r,includePrerelease:!1}).loose?s[f]:s[o]).test(e))return null;try{return new w(e,r)}catch(e){return null}}function w(e,r){if(r&&"object"==typeof r||(r={loose:!!r,includePrerelease:!1}),e instanceof w){if(e.loose===r.loose)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>t)throw new TypeError("version is longer than "+t+" characters");if(!(this instanceof w))return new w(e,r);c("SemVer",e,r),this.options=r,this.loose=!!r.loose;r=e.trim().match(r.loose?s[f]:s[o]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var r=+e;if(0<=r&&r<i)return r}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}n.parse=b,n.valid=function(e,r){e=b(e,r);return e?e.version:null},n.clean=function(e,r){e=b(e.trim().replace(/^[=v]+/,""),r);return e?e.version:null},(n.SemVer=w).prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},w.prototype.toString=function(){return this.version},w.prototype.compare=function(e){return c("SemVer.compare",this.version,this.options,e),e instanceof w||(e=new w(e,this.options)),this.compareMain(e)||this.comparePre(e)},w.prototype.compareMain=function(e){return e instanceof w||(e=new w(e,this.options)),j(this.major,e.major)||j(this.minor,e.minor)||j(this.patch,e.patch)},w.prototype.comparePre=function(e){if(e instanceof w||(e=new w(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var r=0;do{var t=this.prerelease[r],n=e.prerelease[r];if(c("prerelease compare",r,t,n),void 0===t&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===t)return-1;if(t!==n)return j(t,n)}while(++r)},w.prototype.inc=function(e,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r),this.inc("pre",r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",r),this.inc("pre",r);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var t=this.prerelease.length;0<=--t;)"number"==typeof this.prerelease[t]&&(this.prerelease[t]++,t=-2);-1===t&&this.prerelease.push(0)}r&&(this.prerelease[0]!==r||isNaN(this.prerelease[1]))&&(this.prerelease=[r,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},n.inc=function(e,r,t,n){"string"==typeof t&&(n=t,t=void 0);try{return new w(e,t).inc(r,n).version}catch(e){return null}},n.diff=function(e,r){{if(T(e,r))return null;var t,n,i=b(e),o=b(r),s="";for(n in(i.prerelease.length||o.prerelease.length)&&(s="pre",t="prerelease"),i)if(("major"===n||"minor"===n||"patch"===n)&&i[n]!==o[n])return s+n;return t}},n.compareIdentifiers=j;var S=/^[0-9]+$/;function j(e,r){var t=S.test(e),n=S.test(r);return t&&n&&(e=+e,r=+r),e===r?0:t&&!n||(!n||t)&&e<r?-1:1}function E(e,r,t){return new w(e,t).compare(new w(r,t))}function x(e,r,t){return 0<E(e,r,t)}function O(e,r,t){return E(e,r,t)<0}function T(e,r,t){return 0===E(e,r,t)}function _(e,r,t){return 0!==E(e,r,t)}function k(e,r,t){return 0<=E(e,r,t)}function A(e,r,t){return E(e,r,t)<=0}function P(e,r,t,n){switch(r){case"===":return(e="object"==typeof e?e.version:e)===(t="object"==typeof t?t.version:t);case"!==":return(e="object"==typeof e?e.version:e)!==(t="object"==typeof t?t.version:t);case"":case"=":case"==":return T(e,t,n);case"!=":return _(e,t,n);case">":return x(e,t,n);case">=":return k(e,t,n);case"<":return O(e,t,n);case"<=":return A(e,t,n);default:throw new TypeError("Invalid operator: "+r)}}function R(e,r){if(r&&"object"==typeof r||(r={loose:!!r,includePrerelease:!1}),e instanceof R){if(e.loose===!!r.loose)return e;e=e.value}if(!(this instanceof R))return new R(e,r);c("comparator",e,r),this.options=r,this.loose=!!r.loose,this.parse(e),this.semver===B?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}n.rcompareIdentifiers=function(e,r){return j(r,e)},n.major=function(e,r){return new w(e,r).major},n.minor=function(e,r){return new w(e,r).minor},n.patch=function(e,r){return new w(e,r).patch},n.compare=E,n.compareLoose=function(e,r){return E(e,r,!0)},n.rcompare=function(e,r,t){return E(r,e,t)},n.sort=function(e,t){return e.sort(function(e,r){return n.compare(e,r,t)})},n.rsort=function(e,t){return e.sort(function(e,r){return n.rcompare(e,r,t)})},n.gt=x,n.lt=O,n.eq=T,n.neq=_,n.gte=k,n.lte=A,n.cmp=P,n.Comparator=R;var B={};function I(e,r){if(r&&"object"==typeof r||(r={loose:!!r,includePrerelease:!1}),e instanceof I)return e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease?e:new I(e.raw,r);if(e instanceof R)return new I(e.value,r);if(!(this instanceof I))return new I(e,r);if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function $(e){return!e||"x"===e.toLowerCase()||"*"===e}function M(e,r,t,n,i,o,s,a,u,c,f,l,p){return((r=$(t)?"":$(n)?">="+t+".0.0":$(i)?">="+t+"."+n+".0":">="+r)+" "+(a=$(u)?"":$(c)?"<"+(+u+1)+".0.0":$(f)?"<"+u+"."+(+c+1)+".0":l?"<="+u+"."+c+"."+f+"-"+l:"<="+a)).trim()}function V(e,r,t){try{r=new I(r,t)}catch(e){return!1}return r.test(e)}function N(e,r,t,n){var i,o,s,a,u;switch(e=new w(e,n),r=new I(r,n),t){case">":i=x,o=A,s=O,a=">",u=">=";break;case"<":i=O,o=k,s=x,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(V(e,r,n))return!1;for(var c=0;c<r.set.length;++c){var f=r.set[c],l=null,p=null;if(f.forEach(function(e){e.semver===B&&(e=new R(">=0.0.0")),l=l||e,p=p||e,i(e.semver,l.semver,n)?l=e:s(e.semver,p.semver,n)&&(p=e)}),l.operator===a||l.operator===u)return!1;if((!p.operator||p.operator===a)&&o(e,p.semver))return!1;if(p.operator===u&&s(e,p.semver))return!1}return!0}R.prototype.parse=function(e){var r=this.options.loose?s[29]:s[30],r=e.match(r);if(!r)throw new TypeError("Invalid comparator: "+e);this.operator=r[1],"="===this.operator&&(this.operator=""),r[2]?this.semver=new w(r[2],this.options.loose):this.semver=B},R.prototype.toString=function(){return this.value},R.prototype.test=function(e){return c("Comparator.test",e,this.options.loose),this.semver===B||P(e="string"==typeof e?new w(e,this.options):e,this.operator,this.semver,this.options)},R.prototype.intersects=function(e,r){if(!(e instanceof R))throw new TypeError("a Comparator is required");if(r&&"object"==typeof r||(r={loose:!!r,includePrerelease:!1}),""===this.operator)return t=new I(e.value,r),V(this.value,t,r);if(""===e.operator)return t=new I(this.value,r),V(e.semver,t,r);var t=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),n=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),i=this.semver.version===e.semver.version,o=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),s=P(this.semver,"<",e.semver,r)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),r=P(this.semver,">",e.semver,r)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return t||n||i&&o||s||r},(n.Range=I).prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},I.prototype.toString=function(){return this.range},I.prototype.parseRange=function(e){var r=this.options.loose,t=(e=e.trim(),r?s[33]:s[32]),n=(e=e.replace(t,M),c("hyphen replace",e),e=e.replace(s[31],"$1$2$3"),c("comparator trim",e,s[31]),e=(e=(e=e.replace(s[22],"$1~")).replace(s[26],"$1^")).split(/\s+/).join(" "),r?s[29]:s[30]),t=e.split(" ").map(function(e){return e=e,r=this.options,c("comp",e,r),e=function(e,r){return e.trim().split(/\s+/).map(function(e){var o=e,e=r;return c("caret",o,e),e=e.loose?s[y]:s[d],o.replace(e,function(e,r,t,n,i){return c("caret",o,e,r,t,n,i),e=$(r)?"":$(t)?">="+r+".0.0 <"+(+r+1)+".0.0":$(n)?"0"===r?">="+r+"."+t+".0 <"+r+"."+(+t+1)+".0":">="+r+"."+t+".0 <"+(+r+1)+".0.0":i?(c("replaceCaret pr",i),"0"===r?"0"===t?">="+r+"."+t+"."+n+"-"+i+" <"+r+"."+t+"."+(+n+1):">="+r+"."+t+"."+n+"-"+i+" <"+r+"."+(+t+1)+".0":">="+r+"."+t+"."+n+"-"+i+" <"+(+r+1)+".0.0"):(c("no pr"),"0"===r?"0"===t?">="+r+"."+t+"."+n+" <"+r+"."+t+"."+(+n+1):">="+r+"."+t+"."+n+" <"+r+"."+(+t+1)+".0":">="+r+"."+t+"."+n+" <"+(+r+1)+".0.0"),c("caret return",e),e})}).join(" ")}(e,r),c("caret",e),e=function(e,r){return e.trim().split(/\s+/).map(function(e){var o=e,e=r;return e=r.loose?s[m]:s[h],o.replace(e,function(e,r,t,n,i){return c("tilde",o,e,r,t,n,i),e=$(r)?"":$(t)?">="+r+".0.0 <"+(+r+1)+".0.0":$(n)?">="+r+"."+t+".0 <"+r+"."+(+t+1)+".0":i?(c("replaceTilde pr",i),">="+r+"."+t+"."+n+"-"+i+" <"+r+"."+(+t+1)+".0"):">="+r+"."+t+"."+n+" <"+r+"."+(+t+1)+".0",c("tilde return",e),e})}).join(" ")}(e,r),c("tildes",e),e=function(e,r){return c("replaceXRanges",e,r),e.split(/\s+/).map(function(e){var u=e,e=r;return u=u.trim(),e=e.loose?s[p]:s[l],u.replace(e,function(e,r,t,n,i,o){c("xRange",u,e,r,t,n,i,o);var o=$(t),s=o||$(n),a=s||$(i);return"="===r&&a&&(r=""),o?e=">"===r||"<"===r?"<0.0.0":"*":r&&a?(s&&(n=0),i=0,">"===r?(r=">=",i=s?(t=+t+1,n=0):(n=+n+1,0)):"<="===r&&(r="<",s?t=+t+1:n=+n+1),e=r+t+"."+n+"."+i):s?e=">="+t+".0.0 <"+(+t+1)+".0.0":a&&(e=">="+t+"."+n+".0 <"+t+"."+(+n+1)+".0"),c("xRange return",e),e})}).join(" ")}(e,r),c("xrange",e),e=function(e,r){return c("replaceStars",e,r),e.trim().replace(s[g],"")}(e,r),c("stars",e),e;var r},this).join(" ").split(/\s+/);return t=(t=this.options.loose?t.filter(function(e){return!!e.match(n)}):t).map(function(e){return new R(e,this.options)},this)},I.prototype.intersects=function(t,n){if(t instanceof I)return this.set.some(function(e){return e.every(function(r){return t.set.some(function(e){return e.every(function(e){return r.intersects(e,n)})})})});throw new TypeError("a Range is required")},n.toComparators=function(e,r){return new I(e,r).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},I.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new w(e,this.options));for(var r=0;r<this.set.length;r++)if(function(e,r,t){for(var n=0;n<e.length;n++)if(!e[n].test(r))return;if(!r.prerelease.length||t.includePrerelease)return 1;for(n=0;n<e.length;n++)if(c(e[n].semver),e[n].semver!==B&&0<e[n].semver.prerelease.length){var i=e[n].semver;if(i.major===r.major&&i.minor===r.minor&&i.patch===r.patch)return 1}return}(this.set[r],e,this.options))return!0;return!1},n.satisfies=V,n.maxSatisfying=function(e,r,t){var n=null,i=null;try{var o=new I(r,t)}catch(e){return null}return e.forEach(function(e){!o.test(e)||n&&-1!==i.compare(e)||(i=new w(n=e,t))}),n},n.minSatisfying=function(e,r,t){var n=null,i=null;try{var o=new I(r,t)}catch(e){return null}return e.forEach(function(e){!o.test(e)||n&&1!==i.compare(e)||(i=new w(n=e,t))}),n},n.minVersion=function(e,r){e=new I(e,r);var t=new w("0.0.0");if(e.test(t))return t;if(t=new w("0.0.0-0"),e.test(t))return t;t=null;for(var n=0;n<e.set.length;++n)e.set[n].forEach(function(e){var r=new w(e.semver.version);switch(e.operator){case">":0===r.prerelease.length?r.patch++:r.prerelease.push(0),r.raw=r.format();case"":case">=":t&&!x(t,r)||(t=r);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+e.operator)}});if(t&&e.test(t))return t;return null},n.validRange=function(e,r){try{return new I(e,r).range||"*"}catch(e){return null}},n.ltr=function(e,r,t){return N(e,r,"<",t)},n.gtr=function(e,r,t){return N(e,r,">",t)},n.outside=N,n.prerelease=function(e,r){e=b(e,r);return e&&e.prerelease.length?e.prerelease:null},n.intersects=function(e,r,t){return e=new I(e,t),r=new I(r,t),e.intersects(r)},n.coerce=function(e){if(e instanceof w)return e;if("string"!=typeof e)return null;e=e.match(s[20]);return null!=e?b(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0")):null}}),e=(r.SEMVER_SPEC_VERSION,r.re,r.src,r.parse,r.valid,r.clean,r.SemVer,r.inc,r.diff,r.compareIdentifiers,r.rcompareIdentifiers,r.major,r.minor,r.patch,r.compare,r.compareLoose,r.rcompare,r.sort,r.rsort,r.gt,r.lt,r.eq,r.neq,r.gte,r.lte,r.cmp,r.Comparator,r.Range,r.toComparators,r.satisfies,r.maxSatisfying,r.minSatisfying,r.minVersion,r.validRange,r.ltr,r.gtr,r.outside,r.prerelease,r.intersects,r.coerce,r.satisfies(process.version,"^6.12.0 || >=8.0.0")),Te=["RS256","RS384","RS512","ES256","ES384","ES512"],ke=["RS256","RS384","RS512"],Ae=["HS256","HS384","HS512"],Pe=(e&&(Te.splice(3,0,"PS256","PS384","PS512"),ke.splice(3,0,"PS256","PS384","PS512")),1/0),Re=9007199254740991,Be=17976931348623157e292,Ie=NaN,$e="[object Arguments]",Ve="[object Function]",Ne="[object GeneratorFunction]",_e="[object String]",Me="[object Symbol]",Ce=/^\s+|\s+$/g,qe=/^[-+]0x[0-9a-f]+$/i,He=/^0b[01]+$/i,De=/^0o[0-7]+$/i,Ke=/^(?:0|[1-9]\d*)$/,Je=parseInt;function Le(e){return e!=e}function Ge(r,e){for(var t=e,n=function(e){return r[e]},i=-1,o=t?t.length:0,s=Array(o);++i<o;)s[i]=n(t[i],i,t);return s}var Ue,Fe,R=Object.prototype,B=R.hasOwnProperty,I=R.toString,ze=R.propertyIsEnumerable,Ze=(Ue=Object.keys,Fe=Object,function(e){return Ue(Fe(e))}),We=Math.max;function Xe(e,r){var t,n,i,o,s=Qe(e)||function(e){return er(e)&&$(e)}(t=e)&&B.call(t,"callee")&&(!ze.call(t,"callee")||I.call(t)==$e)?function(e,r){for(var t=-1,n=Array(e);++t<e;)n[t]=r(t);return n}(e.length,String):[],a=s.length,u=!!a;for(n in e)!r&&!B.call(e,n)||u&&("length"==n||(i=n,(o=null==(o=a)?Re:o)&&("number"==typeof i||Ke.test(i))&&-1<i&&i%1==0&&i<o))||s.push(n);return s}function Ye(e){if(t="function"==typeof(t=(r=e)&&r.constructor)&&t.prototype||R,r!==t)return Ze(e);var r,t,n,i=[];for(n in Object(e))B.call(e,n)&&"constructor"!=n&&i.push(n);return i}var Qe=Array.isArray;function $(e){return null!=e&&("number"==typeof(r=e.length)&&-1<r&&r%1==0&&r<=Re)&&!function(e){e=V(e)?I.call(e):"";return e==Ve||e==Ne}(e);var r}function V(e){var r=typeof e;return e&&("object"==r||"function"==r)}function er(e){return!!e&&"object"==typeof e}function rr(e){if("number"==typeof e)return e;if("symbol"==typeof(r=e)||er(r)&&I.call(r)==Me)return Ie;if("string"!=typeof(e=V(e)?V(r="function"==typeof e.valueOf?e.valueOf():e)?r+"":r:e))return 0===e?e:+e;e=e.replace(Ce,"");var r=He.test(e);return r||De.test(e)?Je(e.slice(2),r?2:8):qe.test(e)?Ie:+e}var r=function(e,r,t,n){e=$(e)?e:(i=e)?Ge(i,function(e){return($(e)?Xe:Ye)(e)}(i)):[],t=t&&!n?(i=function(e){return e?(e=rr(e))!==Pe&&e!==-Pe?e==e?e:0:(e<0?-1:1)*Be:0===e?e:0}(i=t),n=i%1,i==i?n?i-n:i:0):0;var i,o,n=e.length;return t<0&&(t=We(n+t,0)),"string"==typeof(o=e)||!Qe(o)&&er(o)&&I.call(o)==_e?t<=n&&-1<e.indexOf(r,t):!!n&&-1<function(e,r,t){if(r!=r){for(var n=e,i=Le,o=t,s=void 0,a=n.length,u=o+(s?1:-1);s?u--:++u<a;)if(i(n[u],u,n))return u;return-1}for(var c=t-1,f=e.length;++c<f;)if(e[c]===r)return c;return-1}(e,r,t)},tr=Object.prototype.toString;function nr(e){return!0===e||!1===e||!!(r=e)&&"object"==typeof r&&"[object Boolean]"==tr.call(e);var r}var ir=1/0,or=17976931348623157e292,sr=NaN,ar="[object Symbol]",ur=/^\s+|\s+$/g,cr=/^[-+]0x[0-9a-f]+$/i,fr=/^0b[01]+$/i,lr=/^0o[0-7]+$/i,pr=parseInt,hr=Object.prototype.toString;function mr(e){var r=typeof e;return e&&("object"==r||"function"==r)}function dr(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||!!(r=t)&&"object"==typeof r&&hr.call(t)==ar)return sr;var r;if("string"!=typeof(e=mr(e)?mr(r="function"==typeof e.valueOf?e.valueOf():e)?r+"":r:e))return 0===e?e:+e;e=e.replace(ur,"");var t=fr.test(e);return t||lr.test(e)?pr(e.slice(2),t?2:8):cr.test(e)?sr:+e}var yr=function(e){return"number"==typeof e&&e==(e=function(e){return e?(e=dr(e))!==ir&&e!==-ir?e==e?e:0:(e<0?-1:1)*or:0===e?e:0}(e=e),r=e%1,e==e?r?e-r:e:0);var r},gr=Object.prototype.toString;function vr(e){return"number"==typeof e||!!(r=e)&&"object"==typeof r&&"[object Number]"==gr.call(e);var r}var br,wr,Sr=Function.prototype,jr=Object.prototype,Er=Sr.toString,xr=jr.hasOwnProperty,Or=Er.call(Object),Tr=jr.toString,kr=(br=Object.getPrototypeOf,wr=Object,function(e){return br(wr(e))});var Ar=function(e){if(!(r=e)||"object"!=typeof r||"[object Object]"!=Tr.call(e)||function(e){var r=!1;if(null!=e&&"function"!=typeof e.toString)try{r=!!(e+"")}catch(e){}return r}(e))return!1;var r=kr(e);return null===r||"function"==typeof(e=xr.call(r,"constructor")&&r.constructor)&&e instanceof e&&Er.call(e)==Or},Pr=Object.prototype.toString,Rr=Array.isArray;var N=function(e){return"string"==typeof e||!Rr(e)&&(!!(r=e)&&"object"==typeof r)&&"[object String]"==Pr.call(e);var r},Br="Expected a function",Ir=NaN,$r="[object Symbol]",Vr=/^\s+|\s+$/g,Nr=/^[-+]0x[0-9a-f]+$/i,_r=/^0b[01]+$/i,Mr=/^0o[0-7]+$/i,Cr=parseInt,qr=Object.prototype.toString;function Hr(e,r){var t,n,i;if("function"!=typeof r)throw new TypeError(Br);return n=function(e){return e?(e=Kr(e))!==1/0&&e!==-1/0?e==e?e:0:17976931348623157e292*(e<0?-1:1):0===e?e:0}(n=e),i=n%1,e=n==n?i?n-i:n:0,function(){return 0<--e&&(t=r.apply(this,arguments)),e<=1&&(r=void 0),t}}function Dr(e){var r=typeof e;return e&&("object"==r||"function"==r)}function Kr(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||!!(r=t)&&"object"==typeof r&&qr.call(t)==$r)return Ir;var r;if("string"!=typeof(e=Dr(e)?Dr(r="function"==typeof e.valueOf?e.valueOf():e)?r+"":r:e))return 0===e?e:+e;e=e.replace(Vr,"");var t=_r.test(e);return t||Mr.test(e)?Cr(e.slice(2),t?2:8):Nr.test(e)?Ir:+e}var Jr=function(e){return Hr(2,e)},Sr=["RS256","RS384","RS512","ES256","ES384","ES512","HS256","HS384","HS512","none"],Lr=(e&&Sr.splice(3,0,"PS256","PS384","PS512"),{expiresIn:{isValid:function(e){return yr(e)||N(e)&&e},message:'"expiresIn" should be a number of seconds or string representing a timespan'},notBefore:{isValid:function(e){return yr(e)||N(e)&&e},message:'"notBefore" should be a number of seconds or string representing a timespan'},audience:{isValid:function(e){return N(e)||Array.isArray(e)},message:'"audience" must be a string or array'},algorithm:{isValid:r.bind(null,Sr),message:'"algorithm" must be a valid string enum value'},header:{isValid:Ar,message:'"header" must be an object'},encoding:{isValid:N,message:'"encoding" must be a string'},issuer:{isValid:N,message:'"issuer" must be a string'},subject:{isValid:N,message:'"subject" must be a string'},jwtid:{isValid:N,message:'"jwtid" must be a string'},noTimestamp:{isValid:nr,message:'"noTimestamp" must be a boolean'},keyid:{isValid:N,message:'"keyid" must be a string'},mutatePayload:{isValid:nr,message:'"mutatePayload" must be a boolean'}}),Gr={iat:{isValid:vr,message:'"iat" should be a number of seconds'},exp:{isValid:vr,message:'"exp" should be a number of seconds'},nbf:{isValid:vr,message:'"nbf" should be a number of seconds'}};function Ur(t,n,i,o){if(!Ar(i))throw new Error('Expected "'+o+'" to be a plain object.');Object.keys(i).forEach(function(e){var r=t[e];if(!r){if(n)return;throw new Error('"'+e+'" is not allowed in "'+o+'"')}if(!r.isValid(i[e]))throw new Error(r.message)})}var Fr={audience:"aud",issuer:"iss",subject:"sub",jwtid:"jti"},zr=["expiresIn","notBefore","noTimestamp","audience","issuer","subject","jwtid"],Zr=function(i,t,o,e){var s;if("function"!=typeof o||e||(e=o,o={}),o=o||{},o=Object.assign({},o),s=e||function(e,r){if(e)throw e;return r},o.clockTimestamp&&"number"!=typeof o.clockTimestamp)return s(new O("clockTimestamp must be a number"));if(void 0!==o.nonce&&("string"!=typeof o.nonce||""===o.nonce.trim()))return s(new O("nonce must be a non-empty string"));var a=o.clockTimestamp||Math.floor(Date.now()/1e3);if(!i)return s(new O("jwt must be provided"));if("string"!=typeof i)return s(new O("jwt must be a string"));var u,c=i.split(".");if(3!==c.length)return s(new O("jwt malformed"));try{u=be(i,{complete:!0})}catch(e){return s(e)}if(!u)return s(new O("invalid token"));var r,f=u.header;if("function"==typeof t){if(!e)return s(new O("verify must be called asynchronous if secret or public key is provided as a callback"));r=t}else r=function(e,r){return r(null,t)};return r(f,function(e,r){if(e)return s(new O("error in secret or public key callback: "+e.message));e=""!==c[2].trim();if(!e&&r)return s(new O("jwt signature is required"));if(e&&!r)return s(new O("secret or public key must be provided"));if(e||o.algorithms||(o.algorithms=["none"]),o.algorithms||(o.algorithms=~r.toString().indexOf("BEGIN CERTIFICATE")||~r.toString().indexOf("BEGIN PUBLIC KEY")?Te:~r.toString().indexOf("BEGIN RSA PUBLIC KEY")?ke:Ae),!~o.algorithms.indexOf(u.header.alg))return s(new O("invalid algorithm"));try{t=x.verify(i,u.header.alg,r)}catch(e){return s(e)}if(!t)return s(new O("invalid signature"));var t,e=u.payload;if(void 0!==e.nbf&&!o.ignoreNotBefore){if("number"!=typeof e.nbf)return s(new O("invalid nbf value"));if(e.nbf>a+(o.clockTolerance||0))return s(new Ee("jwt not active",new Date(1e3*e.nbf)))}if(void 0!==e.exp&&!o.ignoreExpiration){if("number"!=typeof e.exp)return s(new O("invalid exp value"));if(a>=e.exp+(o.clockTolerance||0))return s(new xe("jwt expired",new Date(1e3*e.exp)))}if(o.audience){var n=Array.isArray(o.audience)?o.audience:[o.audience];if(!(Array.isArray(e.aud)?e.aud:[e.aud]).some(function(r){return n.some(function(e){return e instanceof RegExp?e.test(r):e===r})}))return s(new O("jwt audience invalid. expected: "+n.join(" or ")))}if(o.issuer&&("string"==typeof o.issuer&&e.iss!==o.issuer||Array.isArray(o.issuer)&&-1===o.issuer.indexOf(e.iss)))return s(new O("jwt issuer invalid. expected: "+o.issuer));if(o.subject&&e.sub!==o.subject)return s(new O("jwt subject invalid. expected: "+o.subject));if(o.jwtid&&e.jti!==o.jwtid)return s(new O("jwt jwtid invalid. expected: "+o.jwtid));if(o.nonce&&e.nonce!==o.nonce)return s(new O("jwt nonce invalid. expected: "+o.nonce));if(o.maxAge){if("number"!=typeof e.iat)return s(new O("iat required when maxAge is specified"));r=P(o.maxAge,e.iat);if(void 0===r)return s(new O('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(a>=r+(o.clockTolerance||0))return s(new xe("maxAge exceeded",new Date(1e3*r)))}return!0===o.complete?(t=u.signature,s(null,{header:f,payload:e,signature:t})):s(null,e)})},Wr=function(t,e,n,r){n="function"==typeof n?(r=n,{}):n||{};var i="object"==typeof t&&!Buffer.isBuffer(t),o=Object.assign({alg:n.algorithm||"HS256",typ:i?"JWT":void 0,kid:n.keyid},n.header);function s(e){if(r)return r(e);throw e}if(!e&&"none"!==n.algorithm)return s(new Error("secretOrPrivateKey must have a value"));if(void 0===t)return s(new Error("payload is required"));if(i){try{Ur(Gr,!0,t,"payload")}catch(e){return s(e)}n.mutatePayload||(t=Object.assign({},t))}else{var a=zr.filter(function(e){return void 0!==n[e]});if(0<a.length)return s(new Error("invalid "+a.join(",")+" option for "+typeof t+" payload"))}if(void 0!==t.exp&&void 0!==n.expiresIn)return s(new Error('Bad "options.expiresIn" option the payload already has an "exp" property.'));if(void 0!==t.nbf&&void 0!==n.notBefore)return s(new Error('Bad "options.notBefore" option the payload already has an "nbf" property.'));try{Ur(Lr,!1,n,"options")}catch(e){return s(e)}a=t.iat||Math.floor(Date.now()/1e3);if(n.noTimestamp?delete t.iat:i&&(t.iat=a),void 0!==n.notBefore){try{t.nbf=P(n.notBefore,a)}catch(e){return s(e)}if(void 0===t.nbf)return s(new Error('"notBefore" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}if(void 0!==n.expiresIn&&"object"==typeof t){try{t.exp=P(n.expiresIn,a)}catch(e){return s(e)}if(void 0===t.exp)return s(new Error('"expiresIn" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}Object.keys(Fr).forEach(function(e){var r=Fr[e];if(void 0!==n[e]){if(void 0!==t[r])return s(new Error('Bad "options.'+e+'" option. The payload already has an "'+r+'" property.'));t[r]=n[e]}});i=n.encoding||"utf8";if("function"!=typeof r)return x.sign({header:o,payload:t,secret:e,encoding:i});r=r&&Jr(r),x.createSign({header:o,privateKey:e,payload:t,encoding:i}).once("error",r).once("done",function(e){r(null,e)})};const Xr={expiresIn:"1h"};const Yr=e=>{try{return JSON.parse(e)}catch(e){return null}};return{jwt:{getToken:function({payload:e,key:r,jwtSetting:t}){return Wr(e,r,{...Xr,...t})},getJWTPayload:function({token:e,key:r}){try{return Zr(e,r)}catch(e){return null}}},json:{parseJson:Yr,getJsonValByKey:({key:e,json:r})=>{r=Yr(r);return r?r[e]:null}},once:function(r){let t;return function(e){t||(t=!0,r(e))}},obj:{getObjValByKey:function(e,r){let t=e;const n=r.replace(/\[(\d+)\]/g,".$1");for(const i of n.split(".")){if(!t[i])return null;t=t[i]}return t}}}});
